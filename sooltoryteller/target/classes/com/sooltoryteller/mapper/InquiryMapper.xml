<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sooltoryteller.mapper.InquiryMapper">

<!-- 모든 1:1문의 리스트 불러오기 
<select id='getList' resultType='com.sooltoryteller.domain.InquiryVO'>
	select i.inquiry_id, m.name, i.title, i.cn, i.inqstus, i.regdate
	from inquiry i, member m
	where i.member_id = m.member_id
	order by inquiry_id desc
</select>

-->

<!-- 모든 1:1문의 리스트 불러오기(관리자) -->
<select id='getList' resultType='com.sooltoryteller.domain.InquiryAdminVO'>
	select  i.inquiry_id, m.name, i.title, i.cn, i.regdate inqRegdate, a.regdate anRegdate, a.anstus
	from inquiry i, member m, inquiry_answer a
	where i.member_id = m.member_id
    and i.inquiry_id = a.inquiry_id(+)
	order by inquiry_id desc
</select>

<!-- 문의 등록 -->
<insert id="insert">
	insert into Inquiry(inquiry_id, member_id,title,cn)
	values (#{inquiryId}, #{memberId}, #{title}, #{cn})
</insert>

<!-- 문의글 조회 -->
<select id="read" resultType="com.sooltoryteller.domain.InquiryVO">
	select i.inquiry_id, m.name, i.title, i.cn, i.inqstus
	from inquiry i, member m
	 where i.member_id = m.member_id
	 and i.inquiry_id = #{inquiryId}
</select>

<!-- 관리자가 문의 조회, 답변전송 시  상태변경 -->
<update id="update">
	update inquiry
	set inqstus = #{inqstus}
	where inquiry_id = #{inquiryId}

</update>

<select id="readStus" resultType="String">
	select inqstus
	from inquiry
	where inquiry_id = #{inquiryId}

</select>

<select id='getMemberId' resultType="Long">
	select member_id
	from inquiry
	where inquiry_id = #{inquiryId}
</select>
</mapper>